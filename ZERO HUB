-- Sistema de Auto Farm Mejorado para ZEIRO HUB
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local Character = Player.Character
local Humanoid = Character:WaitForChild("Humanoid")
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Configuración
local Config = {
    FarmingRange = 50, -- Rango de detección de enemigos
    AttackDelay = 0.1, -- Delay entre ataques
    TeleportOffset = CFrame.new(0, 0, -6), -- Distancia de teleport
    PriorityTargets = { -- Lista de objetivos prioritarios
        "Boss",
        "Elite",
        "Normal"
    },
    AutoCollectDrops = true,
    SafeMode = true -- Modo seguro (evita detección)
}

-- Sistema de detección de enemigos mejorado
local function GetNearestEnemy()
    local nearestEnemy = nil
    local shortestDistance = Config.FarmingRange
    
    local enemies = workspace:FindFirstChild("Enemies")
    if not enemies then return nil end
    
    for _, enemy in pairs(enemies:GetChildren()) do
        if enemy:FindFirstChild("Humanoid") and enemy:FindFirstChild("HumanoidRootPart") then
            if enemy.Humanoid.Health > 0 then
                -- Verificar tipo de enemigo para prioridad
                local enemyType = enemy:GetAttribute("EnemyType") or "Normal"
                local priority = table.find(Config.PriorityTargets, enemyType) or #Config.PriorityTargets + 1
                
                local distance = (enemy.HumanoidRootPart.Position - HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestEnemy = enemy
                end
            end
        end
    end
    
    return nearestEnemy
end

-- Sistema de teleport optimizado
local function TeleportToEnemy(enemy)
    if Config.SafeMode then
        -- Teleport suave para evitar detección
        local targetCFrame = enemy.HumanoidRootPart.CFrame * Config.TeleportOffset
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Linear)
        local tween = game:GetService("TweenService"):Create(HumanoidRootPart, tweenInfo, {CFrame = targetCFrame})
        tween:Play()
        tween.Completed:Wait()
    else
        -- Teleport instantáneo
        HumanoidRootPart.CFrame = enemy.HumanoidRootPart.CFrame * Config.TeleportOffset
    end
end

-- Sistema de ataque mejorado
local function Attack()
    -- Simular clicks y habilidades
    mouse1click()
    
    -- Usar habilidades disponibles
    for _, tool in pairs(Character:GetChildren()) do
        if tool:IsA("Tool") then
            tool:Activate()
            if Config.SafeMode then
                wait(Config.AttackDelay)
            end
        end
    end
end

-- Sistema de recolección de drops
local function CollectDrops()
    if not Config.AutoCollectDrops then return end
    
    local drops = workspace:FindFirstChild("Drops")
    if drops then
        for _, drop in pairs(drops:GetChildren()) do
            if drop:IsA("BasePart") then
                drop.CFrame = HumanoidRootPart.CFrame
            end
        end
    end
end

-- Auto Buso Haki mejorado
local function AutoBuso()
    while wait(5) do
        pcall(function()
            game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("Buso")
        end)
    end
end

-- Función principal de farming
local function StartAutoFarm()
    spawn(AutoBuso) -- Iniciar Buso Haki
    
    while wait() do
        if not getgenv().AutoFarmEnabled then break end
        
        pcall(function()
            local target = GetNearestEnemy()
            if target then
                TeleportToEnemy(target)
                Attack()
                CollectDrops()
            end
        end)
    end
end

-- Interfaz mejorada
local function CreateFarmingInterface()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Parent = game.CoreGui
    
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 200, 0, 100)
    MainFrame.Position = UDim2.new(0.8, 0, 0.5, 0)
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui
    
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(1, 0, 0, 30)
    StatusLabel.Position = UDim2.new(0, 0, 0, 0)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "Estado: Inactivo"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    StatusLabel.Parent = MainFrame
    
    -- Actualizar estado
    spawn(function()
        while wait(1) do
            if getgenv().AutoFarmEnabled then
                StatusLabel.Text = "Estado: Farming Activo"
                StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
            else
                StatusLabel.Text = "Estado: Inactivo"
                StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
            end
        end
    end)
end

-- Inicializar
CreateFarmingInterface()

-- Comandos
getgenv().StartFarming = function()
    getgenv().AutoFarmEnabled = true
    StartAutoFarm()
end

getgenv().StopFarming = function()
    getgenv().AutoFarmEnabled = false
end

-- Notificar inicialización
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "ZEIRO HUB",
    Text = "Auto Farm Mejorado Cargado!",
    Duration = 5
})
